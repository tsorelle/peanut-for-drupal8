var Peanut;!function(e){e.allMessagesType=-1,e.infoMessageType=0,e.errorMessageType=1,e.warningMessageType=2,e.serviceResultSuccess=0,e.serviceResultPending=1,e.serviceResultWarnings=2,e.serviceResultErrors=3,e.serviceResultServiceFailure=4,e.serviceResultServiceNotAvailable=5;var t=function(){function t(){var t=this;this.loadViewModel=function(n,s){e.PeanutLoader.checkConfig();var o=n.split("/"),a="@app";"@"===n.substr(0,1)&&(a=o.shift());var r=(n=o.pop())+"ViewModel",i=a+"/"+o.join("/")+"/vm/"+r,c=t.parseFileName(i,e.Config.values.mvvmPath),p=c.root+c.name+".js",u=c.namespace;e.PeanutLoader.loadScript(p,function(){"verbose"==e.Config.values.loggingMode&&console.log("Loading "+u+"."+r);var t=new window[u][r];t.setVmName(n),s(t)})},this.getComponentPrototype=function(e){return window[e.namespace]&&window[e.namespace][e.className]?window[e.namespace][e.className]:null},this.loadComponentTemplate=function(t,n){e.PeanutLoader.getConfig(function(e){var s=t.root+"templates/"+t.templateFile;jQuery.get(s,function(e){n&&n(e)})})},this.loadComponentPrototype=function(t,n){if(window[t.namespace]&&window[t.namespace][t.className])n(window[t.namespace][t.className]);else{var s=t.root+"components/"+t.className+".js";e.PeanutLoader.load(s,function(){var e=window[t.namespace][t.className];n&&n(e)})}},this.loadAndRegisterComponentPrototype=function(e,n){var s=t.parseComponentName(e);t.loadComponentTemplate(s,function(e){t.loadComponentPrototype(s,function(t){ko.components.register(s.componentName,{viewModel:t,template:e}),n&&n(s)})})},this.registerComponentPrototype=function(e,n){var s=t.parseComponentName(e);t.loadComponentTemplate(s,function(e){var o=t.getComponentPrototype(s);ko.components.register(s.componentName,{viewModel:o,template:e}),n&&n(s)})},this.registerComponentInstance=function(e,n,s){var o=t.parseComponentName(e);t.loadComponentTemplate(o,function(e){t.getViewModelInstance(o,n,function(t){ko.components.register(o.componentName,{viewModel:{instance:t},template:e}),s&&s(o,t)})})},this.registerAndBindComponentInstance=function(e,n,s){t.registerComponentInstance(e,n,function(e,n){t.bindSection(e.componentName+"-container",n),s&&s()})},this.registerComponents=function(e,n){var s=e.shift();s?t.loadAndRegisterComponentPrototype(s,function(){t.registerComponents(e,n)}):n()},this.loadComponentPrototypes=function(n,s){var o=t,a=n.shift();if(a){var r=t.parseComponentName(a),i=r.root+"components/"+r.className+".js";e.PeanutLoader.load(i,function(){o.loadComponentPrototypes(n,s)})}else s()},this.bindNode=function(e,n){var s=t.getContainerNode(e);null!==s&&ko.applyBindingsToNode(s,null,n)},this.bindSection=function(n,s){var o=t.getContainerNode(n);null!==o&&("verbose"==e.Config.values.loggingMode&&console.log("bind section: "+n),ko.applyBindings(s,o),jQuery("#"+n).show())}}return t.prototype.toCamelCase=function(e,t,n){void 0===t&&(t="-"),void 0===n&&(n="pascal");for(var s=e.split(t),o="camel"==n?s.shift():"",a=0,r=s;a<r.length;a++){var i=r[a],c=i.substr(0,1);o=o+(c=c.toUpperCase())+i.substr(1)}return o},t.prototype.parseFileName=function(t,n){void 0===n&&(n=null),n=n||e.Config.values.commonRootPath;var s={root:"",name:"",namespace:"Peanut"},o=t.split("/");if(1==o.length)s.root=n,s.name=t;else if(""==o[0])s.name=o.pop(),s.root=o.join("/")+"/";else{var a=n;switch(o[0]){case"@pnut":a=e.Config.values.peanutRootPath,o.shift();break;case"@core":a=e.Config.values.corePath,o.shift();break;case"@app":s.namespace=e.Config.values.vmNamespace,a=e.Config.values.mvvmPath,o.shift();break;case"@pkg":o.shift();var r=o.shift();s.namespace=this.toCamelCase(r),a=e.Config.values.packagePath+r+"/";break;default:a=n}s.name=o.pop(),s.root=0==o.length?a:a+o.join("/")+"/"}return s},t.prototype.nameToFileName=function(e){var t=e.split("-"),n=t[0];return t.length>1&&(n+=t[1].charAt(0).toUpperCase()+t[1].substring(1)),n},t.prototype.parseComponentName=function(t){var n=this;if(!e.Config.loaded)throw"Peanut Config was not loaded.";"@"!==t.substr(0,1)&&(t="@app/"+t);var s=n.parseFileName(t,e.Config.values.mvvmPath),o=n.nameToFileName(s.name);return{root:s.root,className:o+"Component",templateFile:o+".html",componentName:s.name,namespace:s.namespace}},t.prototype.expandFileName=function(e,t){if(void 0===t&&(t=null),!e)return"";if("/"===e.substr(0,1)||"http"===e.toLowerCase().substr(0,4))return e;var n=this.parseFileName(e,t),s=e.substr(e.lastIndexOf(".")+1);if(s)switch(s.toLowerCase()){case"css":return n.root+"css/"+n.name;case"js":return n.root+"components/"+n.name}return e},t.prototype.loadResources=function(t,n){var s=this;e.PeanutLoader.checkConfig(),e.PeanutLoader.getConfig(function(o){for(var a=[],r=0;r<t.length;r++){var i=s.expandFileName(t[r],o.mvvmPath);a.push(i)}e.PeanutLoader.load(a,n)})},t.prototype.getHtmlTemplate=function(t,n){var s=this;e.PeanutLoader.checkConfig();var o=s.parseFileName(t,e.Config.values.mvvmPath),a=o.name.split("-"),r=a[0]+a[1].charAt(0).toUpperCase()+a[1].substring(1),i=o.root+"templates/"+r+".html";e.PeanutLoader.loadHtml(i,n)},t.prototype.getViewModelInstance=function(e,t,n){t instanceof Function?t(n):n(t)},t.prototype.getContainerNode=function(e){var t=document.getElementById(e);return null==t&&(e?console.warn("Error: Container element '"+e+"' for section binding not found."):console.warn("Error: no container name for section binding.")),t},t}();e.KnockoutHelper=t;var n=function(){function t(){}return t.addTemplate=function(e,n){e=e.split("/").pop(),t.templates[e]=n},t.setWaiterType=function(e){return t.waiterType=e,t.waitDialog=jQuery(t.templates[e])},t.setMessage=function(e){t.waitDialog&&t.waitDialog.find("#wait-message").text(e)},t.setProgress=function(e,n){if(void 0===n&&(n=!1),"progress-waiter"==t.waiterType){var s=t.waitDialog.find("#wait-progress-bar"),o=e+"%";s.css("width",o),n&&s.text(o)}},t.show=function(n,s){if(void 0===n&&(n="Please wait ..."),void 0===s&&(s="spin-waiter"),t.visible)t.setMessage(n);else{var o=t.setWaiterType(s);e.ui.helper.showMessage(n,"wait-message",o),t.visible=!0}},t.hide=function(){t.visible&&t.waitDialog&&(e.ui.helper.hideMessage(t.waitDialog),t.visible=!1)},t.waitDialog=null,t.waiterType="spin-waiter",t.templates=Array(),t.visible=!1,t}();e.WaitMessage=n;var s=function(){return function(){}}();e.mailBox=s;var o=function(){function s(){var o=this;this.startVM=function(n,s){o.koHelper=new t,e.PeanutLoader.getConfig(function(e){o.koHelper.loadViewModel(n,function(e){e.start(o,function(){s&&s(e)})})})},this.loadResources=function(e,t){e instanceof Array?e.join(","):e=e.split(",");e.length;o.koHelper.loadResources(e,function(){t&&t()})},this.getHtmlTemplate=function(e,t){o.koHelper.getHtmlTemplate(e,t)},this.loadWaitMessageTemplate=function(t,s){var a=e.Config.values.uiExtension;t="@pnut/extensions/"+a+"/"+t,o.koHelper.getHtmlTemplate(t,function(e){n.addTemplate(t,e),s()})},this.bindNode=function(e,t){o.koHelper.bindNode(e,t)},this.bindSection=function(e,t){o.koHelper.bindSection(e,t)},this.registerComponents=function(e,t){var n=e;e instanceof Array?n=e.join(","):e=e.split(",");var a=e.length;o.koHelper.registerComponents(e,function(){s.LogMessage("Registered "+a+" components: "+n),t()})},this.registerComponentPrototype=function(e,t){o.koHelper.loadAndRegisterComponentPrototype(e,function(){s.LogMessage("Registered component prototype: "+e),t&&t()})},this.loadComponents=function(e,t){var n=e;e instanceof Array?n=e.join(", "):e=e.split(","),o.koHelper.loadComponentPrototypes(e,function(){s.LogMessage("Registered component prototypes: "+n),t&&t()})},this.registerComponent=function(e,t,n){t?o.koHelper.registerComponentInstance(e,t,function(){s.LogMessage("Registered instance of component: "+e),n()}):o.registerComponentPrototype(e,n)},this.attachComponent=function(e,t,n){t?o.koHelper.registerAndBindComponentInstance(e,t,function(){s.LogMessage("Attached component: "+e),n&&n()}):console.error("attachComponent: No component instance. Use ViewModelBase.attachComponent for component prototypes.")}}return s.prototype.initialize=function(n){var s=this;e.PeanutLoader.checkConfig(),s.koHelper=new t,e.PeanutLoader.loadUiHelper(function(){s.attachComponent("@pnut/service-messages",a.instance,function(){s.loadWaitMessageTemplate("spin-waiter",function(){s.loadWaitMessageTemplate("progress-waiter",function(){n&&n()})})})})},s.prototype.showWaiter=function(e){void 0===e&&(e="Please wait . . ."),n.show(e)},s.prototype.hideWaiter=function(){n.hide()},s.prototype.showProgress=function(e){void 0===e&&(e="Please wait . . ."),n.show(e,"progress-waiter")},s.prototype.setProgress=function(e){n.setProgress(e)},s.prototype.showServiceMessages=function(e){a.instance.setServiceMessages(e)},s.prototype.hideServiceMessages=function(){a.instance.clearMessages()},s.prototype.showError=function(t){t?a.instance.addMessage(t,e.errorMessageType):a.instance.clearMessages(e.errorMessageType)},s.prototype.showMessage=function(t){t?a.instance.addMessage(t,e.infoMessageType):a.instance.clearMessages(e.infoMessageType)},s.prototype.showWarning=function(t){t?a.instance.addMessage(t,e.warningMessageType):a.instance.clearMessages(e.warningMessageType)},s.prototype.setErrorMessage=function(t){t?a.instance.setMessage(t,e.errorMessageType):a.instance.clearMessages(e.errorMessageType)},s.prototype.setInfoMessage=function(t){t?a.instance.setMessage(t,e.infoMessageType):a.instance.clearMessages(e.infoMessageType)},s.prototype.setWarningMessage=function(t){t?a.instance.setMessage(t,e.warningMessageType):a.instance.clearMessages(e.infoMessageType)},s.LogMessage=function(t){"verbose"===e.Config.values.loggingMode&&console.log(t)},s}();e.Application=o;var a=function(){function t(){var n=this;this.errorMessages=ko.observableArray([]),this.infoMessages=ko.observableArray([]),this.warningMessages=ko.observableArray([]),this.addMessage=function(s,o){switch(o){case e.errorMessageType:n.errorMessages.push({type:t.errorClass,text:s});break;case e.warningMessageType:n.warningMessages.push({type:t.warningClass,text:s});break;default:n.infoMessages.push({type:t.infoClass,text:s})}},this.setMessage=function(s,o){switch(o){case e.errorMessageType:n.errorMessages([{type:t.errorClass,text:s}]);break;case e.warningMessageType:n.warningMessages([{type:t.warningClass,text:s}]);break;default:n.infoMessages([{type:t.infoClass,text:s}])}},this.clearMessages=function(t){void 0===t&&(t=e.allMessagesType),t!=e.errorMessageType&&t!=e.allMessagesType||n.errorMessages([]),t!=e.warningMessageType&&t!=e.allMessagesType||n.warningMessages([]),t!=e.infoMessageType&&t!=e.allMessagesType||n.infoMessages([])},this.clearInfoMessages=function(){n.infoMessages([])},this.clearErrorMessages=function(){n.errorMessages([])},this.clearWarningMessages=function(){n.warningMessages([])},this.setServiceMessages=function(s){for(var o=s.length,a=[],r=[],i=[],c=0;c<o;c++){var p=s[c];switch(p.MessageType){case e.errorMessageType:a.push({type:t.errorClass,text:p.Text});break;case e.warningMessageType:r.push({type:t.warningClass,text:p.Text});break;default:i.push({type:t.infoClass,text:p.Text})}}n.errorMessages(a),n.warningMessages(r),n.infoMessages(i)}}return t.instance=new t,t.errorClass="service-message-error",t.infoClass="service-message-information",t.warningClass="service-message-warning",t}(),r=function(){function t(t){var n=this;this.clientApp=t,this.securityToken="",this.errorInfo="",this.setSecurityToken=function(e){n.securityToken=e},this.hideServiceMessages=function(){n.clientApp.hideServiceMessages()},this.showServiceMessages=function(e){n.clientApp.showServiceMessages(e.Messages)},this.handleServiceResponse=function(e){return n.showServiceMessages(e),!0},this.showExceptionMessage=function(e){var t=n.parseErrorResult(e);return n.clientApp.showError(t),t},this.executeRPC=function(t,s,o,a,r){if(void 0===o&&(o=""),!e.Config.loaded)throw"Peanut.config must be initialized before ajax call.";var i=e.Config.values.serviceUrl,c=n;c.errorInfo="",o=o?JSON.stringify(o):"";var p={serviceCode:s,topsSecurityToken:c.securityToken,request:o};return jQuery.ajax({type:t,data:p,dataType:"json",cache:!1,url:i}).done(function(e){c.showServiceMessages(e),a&&a(e)}).fail(function(e,t){var n=c.showExceptionMessage(e);c.errorInfo=e?e.responseText:"",r&&r(n)})},this.executeService=function(e,t,s,o){return void 0===t&&(t=""),n.executeRPC("POST",e,t,s,o)},this.getFromService=function(e,t,s,o){return void 0===t&&(t=""),n.executeRPC("POST",e,t,s,o)};var s=this;s.securityToken=s.readSecurityToken()}return t.getInstance=function(e){return null==t.instance&&(t.instance=new t(e)),t.instance},t.prototype.readSecurityToken=function(){var e=document.cookie;if(e){var t=e.match(new RegExp("peanutSecurity=([^;]+)"));if(t)return t[1]}return""},t.prototype.parseErrorResult=function(e){var t="An unexpected system error occurred.";try{if(e.status){if("404"==e.status)return t+" The web service was not found.";t=t+" Status: "+e.status,e.statusText&&(t=t+" "+e.statusText)}}catch(e){t=t+" Error handling failed: "+e.toString}return t},t.prototype.getInfoMessages=function(t){for(var n=[],s=0,o=0;o<t.length;o++){var a=t[o];a.MessageType==e.infoMessageType&&(n[s++]=a.Text)}return n},t.prototype.getNonErrorMessages=function(t){for(var n=[],s=0,o=0;o<t.length;o++){var a=t[o];a.MessageType!=e.errorMessageType&&(n[s++]=a.Text)}return n},t.prototype.getErrorMessages=function(t){for(var n=[],s=0,o=0;o<t.length;o++){var a=t[o];a.MessageType==e.errorMessageType&&(n[s++]=a.Text)}return n},t.prototype.getMessagesText=function(e){for(var t=[],n=0,s=0;s<e.length;s++){var o=e[s];t[n++]=o.Text}return t},t.prototype.getSecurityToken=function(t){var n={serviceCode:"getxsstoken"};if(!e.Config.loaded)throw"Peanut.config must be initialized before ajax call.";return jQuery.ajax({type:"POST",data:n,dataType:"json",cache:!1,url:e.Config.values.serviceUrl}).done(t)},t.instance=null,t}();e.ServiceBroker=r;var i=function(){return function(e){this.Messages=[],this.Result=0;var t=this;t.Value=e,t.Data=e}}();e.fakeServiceResponse=i;var c=function(){return function(){var e=this;this.start=function(t,n){var s=e;s.application=t,s.services=r.getInstance(t),s.init(function(){n(s)})},this.vmName=null,this.setVmName=function(t){e.vmName=t},this.getVmName=function(){return e.vmName},this.getSectionName=function(){return e.getVmName().toLowerCase()+"-view-container"},this.showDefaultSection=function(){var t=e.getSectionName();jQuery("#"+t).show()},this.bindDefaultSection=function(){var t=e.getSectionName();e.application.bindSection(t,e)},this.attachComponent=function(t,n){e.application.registerComponentPrototype(t,function(){n||(n=t.split("/").pop()+"-container"),e.application.bindSection(n,e)})}}}();e.ViewModelBase=c}(Peanut||(Peanut={}));